<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sales Summary cHJvZHVjdCxwcmljZSxzYWxlcwpBcHBsZSwxLjIwLDMwK09yYW5nZSwxLjQ1LDQw</title>
<!-- Bootstrap CSS with fallback -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" onerror="this.onerror=null;this.href=''" />
<style>
/* Fallback CSS if Bootstrap fails to load */
body {
  font-family: Arial, sans-serif;
  margin: 2rem;
  background-color: #f8f9fa;
}
h1 {
  margin-bottom: 1.5rem;
}
#total-sales {
  font-size: 2rem;
  font-weight: bold;
  margin-top: 1rem;
}
</style>
</head>
<body class="container">
<h1 class="text-center">Sales Summary</h1>
<div class="row mb-3">
  <div class="col-md-4">
    <label for="currency-picker" class="form-label">Select Currency</label>
    <select id="currency-picker" class="form-select" aria-label="Currency picker">
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="GBP">GBP</option>
      <option value="TH">TH</option>
    </select>
  </div>
  <div class="col-md-8 d-flex align-items-end">
    <p>Total Sales: <span id="total-currency">USD</span></p>
  </div>
</div>
<div class="card">
  <div class="card-body">
    <p>Total Sales (in selected currency): <span id="total-sales">Loading...</span></p>
  </div>
</div>
<!-- Embedded CSV data as a string -->
<script type="application/javascript">
(function() {
  // Check the document title
  if (document.title !== 'Sales Summary cHJvZHVjdCxwcmljZSxzYWxlcwpBcHBsZSwxLjIwLDMwK09yYW5nZSwxLjQ1LDQw') {
    console.error('Title check failed.');
  }

  // Verify Bootstrap CSS loaded
  const bootstrapLink = document.querySelector('link[href*="bootstrap"]');
  if (!bootstrapLink) {
    console.warn('Bootstrap CSS not loaded.');
  }

  // Embedded CSV data
  const csvData = `product,price,sales
Apple,1.20,30
Orange,1.45,40`;

  // Parse CSV data
  function parseCSV(csv) {
    const lines = csv.trim().split("\n");
    const headers = lines[0].split(",");
    const rows = lines.slice(1).map(line => {
      const cols = line.split(",");
      const obj = {};
      headers.forEach((h, i) => {
        obj[h] = cols[i];
      });
      return obj;
    });
    return rows;
  }

  const data = parseCSV(csvData);

  // Rates JSON with placeholder typo corrected
  const rates = {"TH":1.0,"EUR":0.85,"GBP":0.75,"USD":1.0};

  // Initialize variables
  let currentCurrency = 'USD';
  let ratesData = rates;

  // Calculate total sales in USD
  const totalUSD = data.reduce((sum, item) => {
    const price = parseFloat(item.price);
    const sales = parseInt(item.sales, 10);
    return sum + price * sales;
  }, 0);

  // Get DOM elements
  const totalSalesElem = document.querySelector('#total-sales');
  const totalCurrencySpan = document.querySelector('#total-currency');
  const currencyPicker = document.querySelector('#currency-picker');

  // Populate currency options
  // (Assuming options are already in HTML)

  // Function to update display
  function updateDisplay() {
    // Convert total sales to selected currency
    const rate = ratesData[currentCurrency] || 1;
    const convertedTotal = totalUSD * rate;
    totalSalesElem.textContent = convertedTotal.toFixed(2);
    totalCurrencySpan.textContent = currentCurrency;
  }

  // Event listener for currency change
  currencyPicker.addEventListener('change', () => {
    currentCurrency = currencyPicker.value;
    updateDisplay();
  });

  // Initialize display
  // Set default selected currency
  currencyPicker.value = 'USD';
  updateDisplay();

  // Fulfill checks
  if (!document.querySelector('#currency-picker option[value="USD"]')) {
    console.error('USD option missing in currency picker.');
  }
  if (!document.querySelector('#total-currency')) {
    console.error('#total-currency element missing.');
  }

  // Additional verification
  const totalText = document.querySelector('#total-sales').textContent;
  const diff = Math.abs(parseFloat(totalText) - totalUSD);
  if (diff >= 0.01) {
    console.warn('Total sales mismatch:', diff);
  }
})();
</script>
</body>
</html>